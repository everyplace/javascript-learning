<!DOCTYPE html>
<html>
  <head>
    <title>Canvas Example</title>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script>
      $(function(){
        var start = new Date();

        (function($){

        	$.fn.canvasScramble = function(options) {


            var generateCoordinatePairs = function(width, height) {
              var randomCoords = {};

              var globalCounter = 0;
              var loopCounter = 0;
              for(var i=0; i<width; i++) {
                if(loopCounter < width) {
                  for(var j=0; j<height; j++) {
                    randomCoords[globalCounter] = [i,j];
                    globalCounter++;
                  }
                  loopCounter++

                } else {
                  loopCounter = 0;
                  for(var j=0; j<height; j++) {
                    randomCoords[globalCounter] = [i,j];
                    globalCounter++;
                  }
                  loopCounter++;
                }
              }
              return randomCoords;
            };

            var shuffle = function(array) {
              var currentIndex = array.length, temporaryValue, randomIndex ;

              // While there remain elements to shuffle...
              while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
              }

              return array;
            };

            var generateRandomIndex = function(limit){
              var globalIndex = [];
              for(var i=0;i<limit;i++) {
                globalIndex.push(i);
              }
              return shuffle(globalIndex);
            }


            $.each(this, function(i, img){
              $img = $(img);
              var wrapper = $("<div>").attr({
                id:"canvasScramble"+i,
                class:"canvasScramble"
              });
              $img.hide().wrap(wrapper);
              $img.detach();
              img.onload = function(){

                var canvas = document.createElement('canvas');
                    canvas.setAttribute('id', 'input');
                    canvas.setAttribute('width', this.width);
                    canvas.setAttribute('height', this.height);

                var output = document.createElement('canvas');
                    output.setAttribute('id', 'output');
                    output.setAttribute('width', this.width);
                    output.setAttribute('height', this.height);

                var totalPixels = this.width * this.height;

                var ctx = canvas.getContext('2d');
                var outputCtx = output.getContext('2d');

                    ctx.drawImage(img,0,0,this.width,this.height);

                var randomInputCoords = generateCoordinatePairs(this.width, this.height);
                var randomOutputCoords = generateCoordinatePairs(this.width, this.height);
                var randomInputIndex = generateRandomIndex(totalPixels);
                var randomOutputIndex = generateRandomIndex(totalPixels);

                for(var j = 0; j<totalPixels; j++) {
                  var randomInput = randomInputCoords[randomInputIndex[j]];
                  var randomInputX = randomInput[0] +1;
                  var randomInputY = randomInput[1] +1;

                  var randomOutput = randomOutputCoords[randomOutputIndex[j]];
                  var randomOutputX = randomOutput[0];
                  var randomOutputY = randomOutput[1];

                  var v1 = randomInputX, v2 = randomInputY, v3 = randomOutputX, v4 = randomOutputY;

                  var imageData = ctx.getImageData(v1,v2,1,1);

                  var outputCtx = output.getContext('2d');
                      outputCtx.putImageData(imageData, v3, v4, 0, 0, 1, 1);

                }

                if(options && options.hasOwnProperty("displayInput") && (options.displayInput === true)) {
                  $("#canvasScramble"+i).append(canvas);
                }
                $("#canvasScramble"+i).append(output);


                if(options && options.hasOwnProperty("debug") && (options.debug === true)) {
                  var time = new Date() - start;
                  console.log(time/1000 + " seconds to process #canvasScramble" + i);
                }

              }
            }); //end each

          } //end $.fn.canvasScramble

        })(jQuery);


        $("img").canvasScramble({debug:true,displayInput:true});

      });
    </script>
  </head>
  <body>
    <img src="erin.jpg" />
    <img src="colors-wide.png" />

  </body>
</html>
